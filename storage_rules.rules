rules_version = '2';

// Reglas de Firebase Storage para proyecto NRXGoAm
service firebase.storage {
  match /b/{bucket}/o {
    
    // Carpeta de iconos del proyecto - Lectura pública, escritura para usuarios autenticados
    match /NRXGoAm/icons/{allPaths=**} {
      // Permitir lectura pública (descarga de iconos)
      allow read: if true;
      // Usuarios autenticados pueden subir/modificar iconos
      allow write: if request.auth != null;
    }
    
    // Archivos de cálculos - Lectura pública, escritura para usuarios autenticados
    match /calculations/{allPaths=**} {
      // Cualquiera puede descargar/ver la imagen
      allow read: if true;
      // Sólo usuarios autenticados pueden subir/modificar/eliminar
      allow write: if request.auth != null;
    }
    
    // Archivos de cálculos 3D - Lectura pública, escritura para usuarios autenticados
    match /calculations_3d/{allPaths=**} {
      // Cualquiera puede descargar/ver la imagen
      allow read: if true;
      // Sólo usuarios autenticados pueden subir/modificar/eliminar
      allow write: if request.auth != null;
    }
    
    // Carpeta de videos públicos para reels
    match /public_videos/{allPaths=**} {
      // Permitir lectura pública (descarga externa)
      allow read: if true;
      // Permitir escritura solo si el usuario está autenticado
      allow write: if request.auth != null;
    }
    
    // Archivos de usuarios específicos (perfiles, documentos privados)
    match /users/{userId}/{allPaths=**} {
      // Solo el propietario puede leer sus archivos
      allow read: if request.auth != null && request.auth.uid == userId;
      // Solo el propietario puede escribir en su carpeta
      allow write: if request.auth != null && request.auth.uid == userId;
    }
    
    // Archivos temporales/cache (para desarrollo y testing)
    match /temp/{allPaths=**} {
      // Permitir lectura para usuarios autenticados
      allow read: if request.auth != null;
      // Permitir escritura para usuarios autenticados (con límite de tiempo)
      allow write: if request.auth != null && 
                     request.time < timestamp.date(2025, 12, 31);
    }
    
    // Archivos de ejemplo para desarrollo (prefijo ASE_)
    match /examples/ASE_{allPaths=**} {
      // Lectura pública para ejemplos
      allow read: if true;
      // Usuarios autenticados pueden modificar ejemplos
      allow write: if request.auth != null;
    }
    
    // Regla por defecto - Denegar todo lo que no coincida con las reglas anteriores
    match /{allPaths=**} {
      allow read, write: if false;
    }
  }
} 